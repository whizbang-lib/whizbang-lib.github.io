// =============================================================================
// Global Styles - Main stylesheet with design system imports
// =============================================================================

// Third-party CSS frameworks - @use must come first
@use 'primeflex/primeflex';

// Design System - Using @use instead of deprecated @import
@use 'styles/theme-tokens' as *;
@use 'styles/design-tokens' as *;
@use 'styles/mixins' as *;
@use 'styles/enhanced-code-blocks' as *;

// Ensure proper box sizing globally
*, *::before, *::after {
    box-sizing: border-box;
}

// Prevent horizontal scrolling on body only
body {
    overflow-x: hidden;
}

/* Prevent flash of unformatted code - hide until enhanced */
pre code:not(.enhanced-marker) {
    opacity: 0;
    transition: opacity wb-duration('base') wb-easing('ease-in-out');
}

pre code.enhanced-marker {
    opacity: 1;
}

// Base styles using design tokens
body {
    font-family: 'Inter', sans-serif;
    margin: 0;
    color: var(--wb-text-primary);
    background: var(--wb-surface-ground);
}

// Allow PrimeNG to manage its own theme variables
// We'll only override specific custom properties that don't interfere with theming

// Custom app-specific overrides that don't conflict with PrimeNG theming
:root:not([data-theme="dark"]) {
    // Keep custom app background
    --wb-surface-ground: #ffffff;
    --wb-surface-card: #ffffff;
    --wb-text-primary: #111827;
    
    // Menu background overrides for better contrast in light mode
    --wb-surface-section: #f3f4f6; /* gray-100 for top-level */
    --wb-surface-border: #e5e7eb;  /* gray-200 for second-level */
}

// Force white background on all major layout elements in light theme
:root:not([data-theme="dark"]) body {
    background-color: #ffffff !important;
}

:root:not([data-theme="dark"]) .p-component {
    background-color: transparent;
}

// Ensure router outlet content has white background
:root:not([data-theme="dark"]) router-outlet + * {
    background-color: #ffffff;
}

// Force toolbar background in light mode - dark gradient for better logo contrast
:root:not([data-theme="dark"]) .fixed-header {
    background: linear-gradient(135deg, #1f2937, #111827) !important;
    color: white !important;
}

:root:not([data-theme="dark"]) .fixed-header .p-toolbar {
    background: linear-gradient(135deg, #1f2937, #111827) !important;
    color: white !important;
}

:root:not([data-theme="dark"]) .gradient-bg {
    background: linear-gradient(135deg, #1f2937, #111827) !important;
    color: white !important;
}

// Dark mode should have the same dark header
:root[data-theme="dark"] .fixed-header {
    background: linear-gradient(135deg, #1f2937, #111827) !important;
    color: white !important;
}

:root[data-theme="dark"] .fixed-header .p-toolbar {
    background: linear-gradient(135deg, #1f2937, #111827) !important;
    color: white !important;
}

:root[data-theme="dark"] .gradient-bg {
    background: linear-gradient(135deg, #1f2937, #111827) !important;
    color: white !important;
}

// Force all header text and icons to be white in dark mode too
:root[data-theme="dark"] .fixed-header {
    .toolbar-nav-button {
        color: white !important;
    }
    
    .p-button {
        color: white !important;
    }
    
    .logo {
        filter: none !important;
    }
}

// Force all header text and icons to be white in light mode
:root:not([data-theme="dark"]) .fixed-header {
    .toolbar-nav-button {
        color: white !important;
    }
    
    .toolbar-nav-button:hover {
        background-color: rgba(255, 255, 255, 0.1) !important;
        color: white !important;
    }
    
    .toolbar-nav-button.active {
        background-color: rgba(255, 255, 255, 0.2) !important;
        color: white !important;
    }
    
    // Search component icons and text
    wb-enhanced-search {
        color: white !important;
        
        .p-inputtext {
            color: white !important;
            
            &::placeholder {
                color: rgba(255, 255, 255, 0.7) !important;
            }
        }
        
        .pi {
            color: white !important;
        }
    }
    
    // Theme toggle component
    wb-theme-toggle {
        color: white !important;
        
        .p-button {
            color: white !important;
        }
        
        .pi {
            color: white !important;
        }
    }
}

// Deep-level menu container override for light mode
:root:not([data-theme="dark"]) .custom-nav-menu.deep-level {
    background: #f9fafb !important; /* gray-50 for deep-level containers */
    border: 1px solid #d1d5db !important; /* gray-300 for border */
    
    // Inset gradient effect for light mode
    box-shadow: 
        inset 2px 2px 4px rgba(0, 0, 0, 0.1),
        inset -1px -1px 2px rgba(255, 255, 255, 0.8) !important;
}

// Deep-level menu container override for dark mode - use higher specificity
html:root[data-theme="dark"] .custom-nav-menu.deep-level {
    background: #2d3748 !important; /* gray-800 - darker than before */
    background-color: #2d3748 !important; /* gray-800 - double override */
    border: 1px solid #4a5568 !important; /* gray-700 for border */
    
    // Inset gradient effect for dark mode - similar to light theme but inverted
    box-shadow: 
        inset 2px 2px 4px rgba(0, 0, 0, 0.4),
        inset -1px -1px 2px rgba(255, 255, 255, 0.1) !important;
}

// Dark theme custom app variables
:root[data-theme="dark"] {
    // Keep custom app variables for parts not managed by PrimeNG
    --wb-surface-ground: #1f2937;
    --wb-surface-card: #374151;
    --wb-text-primary: #f3f4f6;
    
    // Lighter background for deep-level menu containers
    --wb-surface-container: #374151; /* gray-700 for deep-level containers */
}

// Green borders around all sides of top-level menu panels - both light and dark mode
.p-panelmenu .p-panelmenu-panel {
    border: 2px solid #10b981 !important;
    margin-bottom: 0.5rem !important;
}

.p-panelmenu .p-panelmenu-panel:last-child {
    margin-bottom: 0 !important;
}

// Remove borders from child menu items
.p-panelmenu .p-menuitem-link {
    border: none !important;
}

// Dark mode code block overrides - force darker chrome
:root[data-theme="dark"] {
    .enhanced-code-block {
        background: #0a0a0a !important;
        border-color: #1a1a1a !important;
        
        .code-header {
            background: #0f0f0f !important;
        }
        
        .code-tags {
            background: #0f0f0f !important;
        }
        
        .code-container {
            background: linear-gradient(to right, 
                #1a1a1a 0,
                #1a1a1a 3rem, 
                #1a202c 3rem, 
                #1a202c 100%) !important;
        }
        
        .code-description,
        .code-metadata {
            background: #0f0f0f !important;
        }
    }
}

.container {
    @include wb-container;
}

/* Search highlighting styles */
mark.search-highlight {
    background: var(--wb-warning) !important;
    color: var(--wb-warning-text) !important;
    padding: wb-spacing('xs') wb-spacing('xs');
    border-radius: wb-border-radius('sm');
    font-weight: wb-font-weight('medium');
    border: 1px solid var(--wb-warning);
    box-shadow: var(--wb-shadow-sm);
}

/* Search overlay styles */
.search-overlay .p-popover-content {
    padding: 0 !important;
}

/* Gradient background for menubar */
.gradient-bg {
    background: var(--wb-gradient-primary);
}

.gradient-bg .p-menubar {
    background: transparent;
    border: none;
}

// Enhanced code block styles are now imported from _enhanced-code-blocks.scss

// COMPREHENSIVE PrimeNG v19 Overlay Background Fix
// This addresses transparency issues by targeting both the component CSS classes
// and using the correct CSS variable cascade for PrimeNG v19

// Base overlay styling with comprehensive fallbacks
.p-sidebar,
.p-popover,
.p-dropdown-panel,
.p-autocomplete-panel,
.p-dialog,
.p-menu,
.p-contextmenu,
.p-tieredmenu {
  background: var(--p-content-background, #ffffff) !important;
  border: 1px solid var(--p-content-border-color, #e2e8f0) !important;
}

// Specific component styling with PrimeNG v19 variable hierarchy
.p-sidebar {
  background: var(--p-sidebar-background, var(--p-overlay-modal-background, var(--p-content-background, #ffffff))) !important;
}

.p-popover {
  background: var(--p-popover-background, var(--p-overlay-popover-background, var(--p-content-background, #ffffff))) !important;
}

.p-dropdown-panel,
.p-autocomplete-panel {
  background: var(--p-overlay-select-background, var(--p-content-background, #ffffff)) !important;
}

.p-dialog {
  background: var(--p-overlay-modal-background, var(--p-content-background, #ffffff)) !important;
}

// Dark theme comprehensive override
:root[data-theme="dark"] {
  .p-sidebar,
  .p-popover,
  .p-dropdown-panel,
  .p-autocomplete-panel,
  .p-dialog,
  .p-menu,
  .p-contextmenu,
  .p-tieredmenu {
    background: var(--p-content-background, #18181b) !important;
    border: 1px solid var(--p-content-border-color, #3f3f46) !important;
  }

  // Specific dark theme variable hierarchy
  .p-sidebar {
    background: var(--p-sidebar-background, var(--p-overlay-modal-background, var(--p-content-background, #18181b))) !important;
  }

  .p-popover {
    background: var(--p-popover-background, var(--p-overlay-popover-background, var(--p-content-background, #18181b))) !important;
  }

  .p-dropdown-panel,
  .p-autocomplete-panel {
    background: var(--p-overlay-select-background, var(--p-content-background, #18181b)) !important;
  }

  .p-dialog {
    background: var(--p-overlay-modal-background, var(--p-content-background, #18181b)) !important;
  }
}

// Additional safety net for any missed overlay elements
[class*="p-"][class*="panel"],
[class*="p-"][class*="overlay"],
[class*="p-"][class*="dropdown"],
[class*="p-"][class*="menu"] {
  background: var(--p-content-background, #ffffff) !important;
}

:root[data-theme="dark"] [class*="p-"][class*="panel"],
:root[data-theme="dark"] [class*="p-"][class*="overlay"],
:root[data-theme="dark"] [class*="p-"][class*="dropdown"],
:root[data-theme="dark"] [class*="p-"][class*="menu"] {
  background: var(--p-content-background, #18181b) !important;
}

// Push sidebar functionality - shift main content when sidebar is open
// Only apply push layout on desktop/tablet screens
@media (min-width: 769px) {
  body.sidebar-open {
    margin-left: 280px;
    transition: margin-left 0.3s ease;
  }

  body:not(.sidebar-open) {
    margin-left: 0;
    transition: margin-left 0.3s ease;
  }
}

// On mobile screens, disable push layout to prevent horizontal overflow
@media (max-width: 768px) {
  body.sidebar-open,
  body:not(.sidebar-open) {
    margin-left: 0 !important;
  }
}

// =============================================================================
// Mobile Typography & Content Density Enhancements
// =============================================================================

/* Mobile typography improvements */
@media (max-width: 768px) {
  /* Global typography scaling for better mobile readability */
  body {
    font-size: 16px; /* Ensure base font size is readable on mobile */
    line-height: 1.6; /* Improve readability */
  }
  
  /* Heading optimizations for mobile */
  h1 { font-size: 1.75rem; line-height: 1.3; margin-bottom: 1rem; }
  h2 { font-size: 1.5rem; line-height: 1.3; margin-bottom: 0.875rem; }
  h3 { font-size: 1.25rem; line-height: 1.4; margin-bottom: 0.75rem; }
  h4 { font-size: 1.125rem; line-height: 1.4; margin-bottom: 0.75rem; }
  h5 { font-size: 1rem; line-height: 1.5; margin-bottom: 0.5rem; }
  h6 { font-size: 0.875rem; line-height: 1.5; margin-bottom: 0.5rem; }
  
  /* Paragraph and text optimizations */
  p {
    font-size: 1rem;
    line-height: 1.6;
    margin-bottom: 1rem;
  }
  
  /* Ensure all buttons meet minimum touch target requirements */
  .p-button {
    min-height: 44px !important;
    min-width: 44px !important;
    font-size: 1rem !important;
    padding: 0.75rem 1rem !important;
  }
  
  /* Improve card spacing and padding for mobile */
  .p-card {
    .p-card-body {
      padding: 1rem !important;
    }
    
    .p-card-header {
      padding: 1rem 1rem 0.5rem 1rem !important;
    }
    
    .p-card-footer {
      padding: 0.5rem 1rem 1rem 1rem !important;
    }
  }
  
  /* Improve form input sizing for mobile */
  .p-inputtext,
  .p-dropdown,
  .p-multiselect {
    min-height: 44px !important;
    font-size: 1rem !important;
    padding: 0.75rem !important;
  }
  
  /* Container and spacing improvements */
  .container,
  .container-wrapper {
    padding-left: 1rem !important;
    padding-right: 1rem !important;
  }
}

@media (max-width: 480px) {
  /* Enhanced mobile typography for very small screens */
  h1 { font-size: 1.5rem; margin-bottom: 0.75rem; }
  h2 { font-size: 1.375rem; margin-bottom: 0.75rem; }
  h3 { font-size: 1.25rem; margin-bottom: 0.625rem; }
  h4 { font-size: 1.125rem; margin-bottom: 0.625rem; }
  
  /* Larger touch targets for small screens */
  .p-button {
    min-height: 48px !important;
    min-width: 48px !important;
    font-size: 1.125rem !important;
    padding: 1rem 1.25rem !important;
  }
  
  /* Improved form elements for small mobile */
  .p-inputtext,
  .p-dropdown,
  .p-multiselect {
    min-height: 48px !important;
    font-size: 1.125rem !important;
    padding: 1rem !important;
  }
  
  /* Tighter container spacing for small screens */
  .container,
  .container-wrapper {
    padding-left: 0.75rem !important;
    padding-right: 0.75rem !important;
  }
  
  /* Optimize section spacing */
  section {
    padding: 1.5rem 0 !important;
    margin-bottom: 2rem !important;
  }
}

// =============================================================================
// Mermaid Diagram Styles
// =============================================================================

.mermaid-diagram {
  margin: 2rem 0;
  padding: 1rem;
  background: var(--wb-surface-card);
  border-radius: 8px;
  border: 1px solid var(--wb-surface-border);
  overflow-x: auto;

  svg {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
  }
}

// Dark mode Mermaid adjustments
:root[data-theme="dark"] .mermaid-diagram {
  background: #1a1a1a;
  border-color: #2a2a2a;
}

// Mobile responsiveness for diagrams
@media (max-width: 768px) {
  .mermaid-diagram {
    padding: 0.5rem;
    margin: 1rem 0;

    svg {
      font-size: 12px;
    }
  }
}

// =============================================================================
// Mermaid Diagram Semantic Class Styling (Theme-Aware)
// =============================================================================

// Light mode colors - Architectural Layers
:root:not([data-theme="dark"]) .mermaid-diagram {
  // === SUBGRAPH CLUSTER STYLING (Entire subgraph boxes) ===
  // Use lighter/more transparent shades than individual nodes

  // ORM subgraph - lighter red/pink (event/data layer color)
  #ORM rect {
    fill: rgba(220, 53, 69, 0.08) !important;
    stroke: #dc3545 !important;
    stroke-width: 0.125em !important;
    rx: 8px !important;
    ry: 8px !important;
  }

  // Message Broker Adapters subgraph - lighter yellow (command layer color)
  #Messaging rect {
    fill: rgba(255, 193, 7, 0.08) !important;
    stroke: #ffc107 !important;
    stroke-width: 0.125em !important;
    rx: 8px !important;
    ry: 8px !important;
  }

  // Developer Tools subgraph - lighter purple (infrastructure layer color)
  #Dev rect {
    fill: rgba(139, 92, 246, 0.08) !important;
    stroke: #8b5cf6 !important;
    stroke-width: 0.125em !important;
    rx: 8px !important;
    ry: 8px !important;
  }

  // Core Packages subgraph - lighter green (core layer color)
  #Core rect {
    fill: rgba(40, 167, 69, 0.08) !important;
    stroke: #28a745 !important;
    stroke-width: 0.125em !important;
    rx: 8px !important;
    ry: 8px !important;
  }

  // Observability subgraph - lighter teal (observability layer color)
  #Observability rect {
    fill: rgba(20, 184, 166, 0.08) !important;
    stroke: #14b8a6 !important;
    stroke-width: 0.125em !important;
    rx: 8px !important;
    ry: 8px !important;
  }

  // Subgraph header (cluster label) color styling
  // Note: Size and centering configured in MermaidService themeCSS
  #ORM .cluster-label text,
  #ORM .cluster-label span {
    fill: #dc3545 !important;
    color: #dc3545 !important;
  }

  #Messaging .cluster-label text,
  #Messaging .cluster-label span {
    fill: #ffc107 !important;
    color: #ffc107 !important;
  }

  #Dev .cluster-label text,
  #Dev .cluster-label span {
    fill: #8b5cf6 !important;
    color: #8b5cf6 !important;
  }

  #Core .cluster-label text,
  #Core .cluster-label span {
    fill: #28a745 !important;
    color: #28a745 !important;
  }

  #Observability .cluster-label text,
  #Observability .cluster-label span {
    fill: #14b8a6 !important;
    color: #14b8a6 !important;
  }


  // === ARCHITECTURAL LAYERS (Semantic Meaning) ===

  // Business logic layer (green)
  .layer-business,
  .layer-core {
    rect, polygon, circle, ellipse {
      fill: #d4edda !important;
      stroke: #28a745 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #155724 !important;
    }
  }

  // Edge labels for core layer
  .edgeLabel.layer-business span,
  .edgeLabel.layer-business p,
  .edgeLabel.layer-core span,
  .edgeLabel.layer-core p,
  span.edgeLabel.layer-core,
  p.edgeLabel.layer-core,
  g.edgeLabel.layer-core span.edgeLabel,
  g.edgeLabel.layer-core p.edgeLabel {
    color: #28a745 !important;
  }

  // Read model / Query layer (blue)
  .layer-read,
  .layer-query,
  .layer-projection {
    rect, polygon, circle, ellipse {
      fill: #cce5ff !important;
      stroke: #004085 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #003366 !important;
    }
  }

  // Edge labels for read layer
  .edgeLabel.layer-read span,
  .edgeLabel.layer-read p,
  .edgeLabel.layer-query span,
  .edgeLabel.layer-query p,
  .edgeLabel.layer-projection span,
  .edgeLabel.layer-projection p {
    color: #004085 !important;
  }

  // Command / Write layer (yellow/orange)
  .layer-command,
  .layer-write {
    rect, polygon, circle, ellipse {
      fill: #fff3cd !important;
      stroke: #ffc107 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #856404 !important;
    }
  }

  // Edge labels for command layer
  .edgeLabel.layer-command span,
  .edgeLabel.layer-command p,
  .edgeLabel.layer-write span,
  .edgeLabel.layer-write p,
  span.edgeLabel.layer-command,
  p.edgeLabel.layer-command,
  g.edgeLabel.layer-command span.edgeLabel,
  g.edgeLabel.layer-command p.edgeLabel {
    color: #ffc107 !important;
  }

  // Event / Data layer (red/pink)
  .layer-event,
  .layer-data {
    rect, polygon, circle, ellipse {
      fill: #f8d7da !important;
      stroke: #dc3545 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #721c24 !important;
    }
  }

  // Edge labels for event layer
  .edgeLabel.layer-event span,
  .edgeLabel.layer-event p,
  .edgeLabel.layer-data span,
  .edgeLabel.layer-data p,
  span.edgeLabel.layer-event,
  p.edgeLabel.layer-event,
  g.edgeLabel.layer-event span.edgeLabel,
  g.edgeLabel.layer-event p.edgeLabel {
    color: #dc3545 !important;
  }

  // Observability / Telemetry layer (teal/cyan)
  .layer-observability,
  .layer-telemetry {
    rect, polygon, circle, ellipse {
      fill: #ccfbf1 !important;
      stroke: #14b8a6 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #115e59 !important;
    }
  }

  // Edge labels for observability layer
  .edgeLabel.layer-observability span,
  .edgeLabel.layer-observability p,
  .edgeLabel.layer-telemetry span,
  .edgeLabel.layer-telemetry p,
  span.edgeLabel.layer-observability,
  p.edgeLabel.layer-observability,
  g.edgeLabel.layer-observability span.edgeLabel,
  g.edgeLabel.layer-observability p.edgeLabel {
    color: #14b8a6 !important;
  }

  // Infrastructure / Tools layer (purple)
  .layer-infrastructure,
  .layer-tools {
    rect, polygon, circle, ellipse {
      fill: #e7d4f8 !important;
      stroke: #8b5cf6 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #5b21b6 !important;
    }
  }

  // Edge labels for infrastructure layer
  .edgeLabel.layer-infrastructure span,
  .edgeLabel.layer-infrastructure p,
  .edgeLabel.layer-tools span,
  .edgeLabel.layer-tools p,
  span.edgeLabel.layer-infrastructure,
  p.edgeLabel.layer-infrastructure,
  g.edgeLabel.layer-infrastructure span.edgeLabel,
  g.edgeLabel.layer-infrastructure p.edgeLabel {
    color: #8b5cf6 !important;
  }

  // === COLOR BUCKETS (Visual Grouping) ===
  // For grouping related items with coordinated colors

  // Bucket A - Vibrant Blue
  .bucket-a {
    rect, polygon, circle, ellipse {
      fill: #bfdbfe !important;
      stroke: #3b82f6 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #1e40af !important;
    }
  }

  // Bucket B - Vibrant Green
  .bucket-b {
    rect, polygon, circle, ellipse {
      fill: #bbf7d0 !important;
      stroke: #22c55e !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #15803d !important;
    }
  }

  // Bucket C - Vibrant Orange
  .bucket-c {
    rect, polygon, circle, ellipse {
      fill: #fed7aa !important;
      stroke: #f97316 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #9a3412 !important;
    }
  }

  // Bucket D - Vibrant Purple
  .bucket-d {
    rect, polygon, circle, ellipse {
      fill: #ddd6fe !important;
      stroke: #a855f7 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #6b21a8 !important;
    }
  }

  // Bucket E - Vibrant Pink
  .bucket-e {
    rect, polygon, circle, ellipse {
      fill: #fbcfe8 !important;
      stroke: #ec4899 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #9f1239 !important;
    }
  }

  // Bucket A - edges and labels (class applied via JavaScript)
  path.bucket-a {
    stroke: #3b82f6 !important;
    stroke-width: 0.125em !important;
  }

  .edgeLabel.bucket-a span,
  .edgeLabel.bucket-a p {
    color: #3b82f6 !important;
  }

  // Bucket B - edges and labels (class applied via JavaScript)
  path.bucket-b {
    stroke: #22c55e !important;
    stroke-width: 0.125em !important;
  }

  .edgeLabel.bucket-b span,
  .edgeLabel.bucket-b p {
    color: #22c55e !important;
  }

  // Bucket C - edges and labels (class applied via JavaScript)
  path.bucket-c {
    stroke: #f97316 !important;
    stroke-width: 0.125em !important;
  }

  .edgeLabel.bucket-c span,
  .edgeLabel.bucket-c p {
    color: #f97316 !important;
  }

  // Bucket D - edges and labels (class applied via JavaScript)
  path.bucket-d {
    stroke: #a855f7 !important;
    stroke-width: 0.125em !important;
  }

  .edgeLabel.bucket-d span,
  .edgeLabel.bucket-d p {
    color: #a855f7 !important;
  }

  // Bucket E - edges and labels (class applied via JavaScript)
  path.bucket-e {
    stroke: #ec4899 !important;
    stroke-width: 0.125em !important;
  }

  .edgeLabel.bucket-e span,
  .edgeLabel.bucket-e p {
    color: #ec4899 !important;
  }

  // === GLOBAL MARKER (ARROWHEAD) STYLING ===
  // Fix for Mermaid.js arrowhead visibility - make them MASSIVE (50x)
  svg defs marker {
    width: 500px !important;   // 50x larger than default ~10px
    height: 500px !important;  // 50x larger than default ~10px
    
    path {
      fill: #64748b !important;     // Dark gray for default arrows
      stroke: #64748b !important;   // Add stroke for more visibility
      stroke-width: 20px !important; // Much thicker stroke
      transform: scale(50) !important; // Make arrowhead 50x larger
    }
  }

  // Ensure edge link paths are visible and much thicker
  svg path.flowchart-link {
    stroke: #64748b !important;
    stroke-width: 20px !important;  // Make lines much thicker
  }

  // Force visible arrow markers using CSS since Mermaid isn't generating them
  svg path[marker-end] {
    stroke: #64748b !important;
    stroke-width: 20px !important;
    stroke-linecap: round !important;
  }

  // Try to create arrow-like endings using stroke properties
  svg path[marker-end]::after {
    content: '';
    display: block;
    width: 0;
    height: 0;
    border-left: 20px solid #64748b;
    border-top: 10px solid transparent;
    border-bottom: 10px solid transparent;
    position: absolute;
  }
}

// Dark mode colors - higher contrast with darker backgrounds
:root[data-theme="dark"] .mermaid-diagram {
  // === SUBGRAPH CLUSTER STYLING (Entire subgraph boxes) ===
  // Use lighter/more transparent shades than individual nodes

  // ORM subgraph - lighter red/pink (event/data layer color, dark mode)
  #ORM rect {
    fill: rgba(248, 113, 113, 0.08) !important;
    stroke: #f87171 !important;
    stroke-width: 0.125em !important;
  }

  // Message Broker Adapters subgraph - lighter yellow (command layer color, dark mode)
  #Messaging rect {
    fill: rgba(251, 191, 36, 0.08) !important;
    stroke: #fbbf24 !important;
    stroke-width: 0.125em !important;
  }

  // Developer Tools subgraph - lighter purple (infrastructure layer color, dark mode)
  #Dev rect {
    fill: rgba(167, 139, 250, 0.08) !important;
    stroke: #a78bfa !important;
    stroke-width: 0.125em !important;
  }

  // Core Packages subgraph - lighter green (core layer color, dark mode)
  #Core rect {
    fill: rgba(72, 187, 120, 0.08) !important;
    stroke: #48bb78 !important;
    stroke-width: 0.125em !important;
  }

  // Observability subgraph - lighter teal (observability layer color, dark mode)
  #Observability rect {
    fill: rgba(94, 234, 212, 0.08) !important;
    stroke: #5eead4 !important;
    stroke-width: 0.125em !important;
  }

  // Subgraph header (cluster label) color styling - dark mode
  // Note: Size and centering configured in MermaidService themeCSS
  #ORM .cluster-label text,
  #ORM .cluster-label span {
    fill: #f87171 !important;
    color: #f87171 !important;
  }

  #Messaging .cluster-label text,
  #Messaging .cluster-label span {
    fill: #fbbf24 !important;
    color: #fbbf24 !important;
  }

  #Dev .cluster-label text,
  #Dev .cluster-label span {
    fill: #a78bfa !important;
    color: #a78bfa !important;
  }

  #Core .cluster-label text,
  #Core .cluster-label span {
    fill: #48bb78 !important;
    color: #48bb78 !important;
  }

  #Observability .cluster-label text,
  #Observability .cluster-label span {
    fill: #5eead4 !important;
    color: #5eead4 !important;
  }

  // Subgraph edge colors (lines from subgraphs) - dark mode
  path[id*="ORM"] {
    stroke: #f87171 !important;
    stroke-width: 0.125em !important;
  }

  .edgeLabel[id*="ORM"] span,
  .edgeLabel[id*="ORM"] p {
    color: #f87171 !important;
  }

  path[id*="Messaging"] {
    stroke: #fbbf24 !important;
    stroke-width: 0.125em !important;
  }

  .edgeLabel[id*="Messaging"] span,
  .edgeLabel[id*="Messaging"] p {
    color: #fbbf24 !important;
  }

  path[id*="Dev"] {
    stroke: #a78bfa !important;
    stroke-width: 0.125em !important;
  }

  .edgeLabel[id*="Dev"] span,
  .edgeLabel[id*="Dev"] p {
    color: #a78bfa !important;
  }

  path[id*="Observability"] {
    stroke: #5eead4 !important;
    stroke-width: 0.125em !important;
  }

  .edgeLabel[id*="Observability"] span,
  .edgeLabel[id*="Observability"] p {
    color: #5eead4 !important;
  }

  // === GLOBAL MARKER (ARROWHEAD) STYLING ===
  // Fix for Mermaid.js arrowhead visibility - make them MASSIVE (50x)
  svg defs marker {
    width: 500px !important;   // 50x larger than default ~10px
    height: 500px !important;  // 50x larger than default ~10px
    
    path {
      fill: #94a3b8 !important;     // Light gray for default arrows
      stroke: #94a3b8 !important;   // Add stroke for more visibility
      stroke-width: 20px !important; // Much thicker stroke
      transform: scale(50) !important; // Make arrowhead 50x larger
    }
  }

  // Ensure edge link paths are visible and much thicker
  svg path.flowchart-link {
    stroke: #94a3b8 !important;
    stroke-width: 20px !important;  // Make lines much thicker
  }

  // Force visible arrow markers using CSS since Mermaid isn't generating them
  svg path[marker-end] {
    stroke: #94a3b8 !important;
    stroke-width: 20px !important;
    stroke-linecap: round !important;
  }

  // Try to create arrow-like endings using stroke properties
  svg path[marker-end]::after {
    content: '';
    display: block;
    width: 0;
    height: 0;
    border-left: 20px solid #94a3b8;
    border-top: 10px solid transparent;
    border-bottom: 10px solid transparent;
    position: absolute;
  }

  // === ARCHITECTURAL LAYERS (Semantic Meaning) ===

  // Business logic layer (green) - darker background, lighter border
  .layer-business,
  .layer-core {
    rect, polygon, circle, ellipse {
      fill: #1e4620 !important;
      stroke: #48bb78 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #e2e8f0 !important;
    }
  }

  // Read model / Query layer (blue) - darker background
  .layer-read,
  .layer-query,
  .layer-projection {
    rect, polygon, circle, ellipse {
      fill: #1e3a5f !important;
      stroke: #60a5fa !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #e2e8f0 !important;
    }
  }

  // Command / Write layer (yellow/orange) - darker background
  .layer-command,
  .layer-write {
    rect, polygon, circle, ellipse {
      fill: #4a3410 !important;
      stroke: #fbbf24 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #e2e8f0 !important;
    }
  }

  // Event / Data layer (red/pink) - darker background
  .layer-event,
  .layer-data {
    rect, polygon, circle, ellipse {
      fill: #4a1a20 !important;
      stroke: #f87171 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #e2e8f0 !important;
    }
  }

  // Observability / Telemetry layer (teal/cyan) - darker background
  .layer-observability,
  .layer-telemetry {
    rect, polygon, circle, ellipse {
      fill: #134e4a !important;
      stroke: #5eead4 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #e2e8f0 !important;
    }
  }

  // Infrastructure / Tools layer (purple) - darker background
  .layer-infrastructure,
  .layer-tools {
    rect, polygon, circle, ellipse {
      fill: #3a2056 !important;
      stroke: #a78bfa !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #e2e8f0 !important;
    }
  }

  // === COLOR BUCKETS (Visual Grouping) ===

  // Bucket A - Vibrant Blue (dark mode)
  .bucket-a {
    rect, polygon, circle, ellipse {
      fill: #1e3a8a !important;
      stroke: #60a5fa !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #e2e8f0 !important;
    }
  }

  // Bucket B - Vibrant Green (dark mode)
  .bucket-b {
    rect, polygon, circle, ellipse {
      fill: #166534 !important;
      stroke: #4ade80 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #e2e8f0 !important;
    }
  }

  // Bucket C - Vibrant Orange (dark mode)
  .bucket-c {
    rect, polygon, circle, ellipse {
      fill: #7c2d12 !important;
      stroke: #fb923c !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #e2e8f0 !important;
    }
  }

  // Bucket D - Vibrant Purple (dark mode)
  .bucket-d {
    rect, polygon, circle, ellipse {
      fill: #581c87 !important;
      stroke: #c084fc !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #e2e8f0 !important;
    }
  }

  // Bucket E - Vibrant Pink (dark mode)
  .bucket-e {
    rect, polygon, circle, ellipse {
      fill: #831843 !important;
      stroke: #f472b6 !important;
      stroke-width: 0.125em !important;
    }
    .nodeLabel {
      color: #e2e8f0 !important;
    }
  }

  // Apply bucket colors to edges/paths (lines AND markers) - dark mode
  .bucket-a {
    path.edge, line.edge {
      stroke: #60a5fa !important;
      stroke-width: 0.125em !important;
    }
    .edgePath path, .edge-thickness-normal {
      stroke: #60a5fa !important;
    }
    marker path {
      fill: #60a5fa !important;
      stroke: #60a5fa !important;
    }
  }

  path[id*="WhizEF"],
  path[id*="WhizKafka"] {
    stroke: #60a5fa !important;
    stroke-width: 0.125em !important;
  }

  .bucket-b {
    path.edge, line.edge {
      stroke: #4ade80 !important;
      stroke-width: 0.125em !important;
    }
    .edgePath path, .edge-thickness-normal {
      stroke: #4ade80 !important;
    }
    marker path {
      fill: #4ade80 !important;
      stroke: #4ade80 !important;
    }
  }

  path[id*="WhizDapper"],
  path[id*="WhizRabbit"] {
    stroke: #4ade80 !important;
    stroke-width: 0.125em !important;
  }

  .bucket-c {
    path.edge, line.edge {
      stroke: #fb923c !important;
      stroke-width: 0.125em !important;
    }
    .edgePath path, .edge-thickness-normal {
      stroke: #fb923c !important;
    }
    marker path {
      fill: #fb923c !important;
      stroke: #fb923c !important;
    }
  }

  path[id*="WhizNH"],
  path[id*="WhizASB"] {
    stroke: #fb923c !important;
    stroke-width: 0.125em !important;
  }

  .bucket-d {
    path.edge, line.edge {
      stroke: #c084fc !important;
      stroke-width: 0.125em !important;
    }
    .edgePath path, .edge-thickness-normal {
      stroke: #c084fc !important;
    }
    marker path {
      fill: #c084fc !important;
      stroke: #c084fc !important;
    }
  }

  path[id*="WhizSQS"] {
    stroke: #c084fc !important;
    stroke-width: 0.125em !important;
  }

  .bucket-e {
    path.edge, line.edge {
      stroke: #f472b6 !important;
      stroke-width: 0.125em !important;
    }
    .edgePath path, .edge-thickness-normal {
      stroke: #f472b6 !important;
    }
    marker path {
      fill: #f472b6 !important;
      stroke: #f472b6 !important;
    }
  }

  path[id*="WhizOTel"],
  path[id*="WhizDash"] {
    stroke: #f472b6 !important;
    stroke-width: 0.125em !important;
  }
}